---
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import WorkCard from '../../components/WorkCard.astro';
import Model3D from '../../components/Model3D.astro';
import { getCollection } from 'astro:content';
import { locales, type Locale } from '../../i18n/utils';
import { t } from '../../i18n/translations';
import '../../styles/global.css';

// Export getStaticPaths for dynamic route
// Include all locales including default (zh) to handle /zh path explicitly
export async function getStaticPaths() {
  return locales.map((locale) => ({
    params: { locale },
  }));
}

// Get locale from params
const { locale } = Astro.params;
// Get all works from Content Collections
const allWorks = await getCollection('works');

// Filter works by language
// Works are organized in subdirectories: works/zh/, works/en/, works/ja/
// Each work has a lang field that matches the subdirectory
const works = allWorks.filter((work) => {
  // Check if work has lang field matching current locale
  return work.data.lang === locale;
});

// Get page title and description
const pageTitle = t('meta.title', locale as Locale);
const pageDescription = t('meta.description', locale as Locale);
---

<!doctype html>
<html lang={locale as string}>
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={pageDescription} />
    <title>{pageTitle}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" rel="stylesheet" />
  </head>
  <body class="min-h-screen">
    <Header locale={locale as Locale} />
    <main class="max-w-[800px] mx-auto px-6 md:pt-32 pt-16 pb-20 relative">
      <!-- Hero Section with 3D Container -->
      <div class="h-[220px] md:h-[360px] relative pointer-events-none">
        <section class="w-[calc(100%-3rem)] aspect-square md:w-[800px] md:h-[640px] absolute -top-[40px] md:-top-[100px] left-1/2 transform -translate-x-1/2 z-0 pointer-events-auto">
          <div class="relative w-full h-full">
            <Model3D 
              modelPath="/models/capybara.glb"
              canvasId="capybara-canvas"
              autoRotate={true}
              rotationSpeed={0.01}
              backgroundColor="#202023"
            />
          </div>
        </section>
      </div>

      <!-- Works Section -->
      <section id="works" class="relative z-10">
        <h2 class="text-2xl font-bold mb-8 inline-block border-b-4 border-white/10 pb-1">{t('works.title', locale as Locale)}</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-12">
          {works.map((work) => (
            <WorkCard
              title={work.data.title}
              description={work.data.description}
              image={work.data.image}
              icon={!work.data.image ? 'restaurant' : undefined}
              iconColor={!work.data.image ? 'orange' : undefined}
              link={work.data.link}
            />
          ))}
        </div>
      </section>
    </main>
    <Footer locale={locale as Locale} />
  </body>
</html>
